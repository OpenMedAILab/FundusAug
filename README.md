# FundusAug
# 眼科影像数据增强与类别平衡工具

## 简介
本项目专为眼科医学影像（如眼底彩照）设计，旨在解决深度学习训练中常见的**类别不平衡**问题。通过集成 **Albumentations** 官方推荐的医疗影像增强方案，本工具能够自动识别多类别标签（0, 1, 2, 3...），并以多数类为基准，对少数类进行针对性的物理增强或逻辑模拟。

### 核心特性
- **多类别支持**：自动识别并平衡所有级别的疾病标签。
- **双模式切换**：支持真实图片物理增强模式与随机占位图模拟模式。
- **专业增强策略**：包含 CLAHE（对比度受限自适应直方图均衡化）、几何变换、色彩抖动等医疗影像专用算法。
- **路径保护**：完美保留 `left/right` 左右眼层级信息。

---

## 0. 安装环境
在运行脚本之前，请确保您的 Python 环境中已安装以下依赖库：

```bash
pip install opencv-python albumentations tqdm numpy
```

---

## 1. 准备数据集

### 数据存放
请将您的原始图像文件夹放置在项目根目录下，结构建议如下：
```text
project_root/
├── ultimate_augment_tool_v9.py
├── test.txt
└── images/
    ├── left/
    └── right/
```

### 示例数据下载
如果您需要测试脚本功能，可以下载以下示例数据集：
- **下载地址**：[夸克网盘 - 眼科示例影像](https://pan.quark.cn/s/b8c0fd776b0c)

下载后请解压并将 `images` 文件夹放入项目根目录。

---

## 2. 终端运行命令

脚本支持通过命令行参数灵活配置运行模式和增强比例。

### 场景 A：处理真实图片（推荐用于正式训练）
将少数类标签扩充至多数类的 40%：
```powershell
python ultimate_augment_tool_v9.py --input test.txt --mode real --ratio 0.3
```

### 场景 B：随机生成图像（用于流程演示或调试）
```powershell
python ultimate_augment_tool_v9.py --input test.txt --mode random --ratio 0.3
```

### 参数详解
| 参数 | 说明 | 示例 |
| :--- | :--- | :--- |
| `--input` | **(必填)** 输入的标签文件路径 | `test.txt` |
| `--mode` | 运行模式：`real` (真实图片) 或 `random` (随机生成) | `real` |
| `--ratio` | 目标比例：少数类数量 / 多数类数量 | `0.3` (即 10:3) |
| `--output_txt` | 生成的增强标签文件名 | `augmented_labels.txt` |

---

## 注意事项
1. **数据备份**：虽然脚本会将增强后的图片保存在独立的 `images/augmented_images/` 文件夹中，但建议在操作前对原始数据进行备份。
2. **路径格式**：脚本会自动处理 Windows/Linux 的路径斜杠差异，请放心使用。
3. **性能建议**：处理大规模数据（>5万张）时，物理增强模式可能需要一定时间，请耐心等待进度条完成。
